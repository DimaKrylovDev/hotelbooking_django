{% extends "main/layout.html" %}

{% block content %}
<style>
    .profile-wrapper {
        display: grid;
        gap: 2rem;
        padding: 1rem 0 3rem;
        background: #f5f5f5;
        min-height: 100vh;
    }

    .profile-card, .summary-card {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        padding: 2rem;
    }

    .profile-header {
        display: flex;
        align-items: center;
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .profile-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: var(--primary-color);
        display: grid;
        place-items: center;
        color: white;
        font-size: 1.5rem;
        font-weight: 700;
        flex-shrink: 0;
    }

    .profile-header-content h1 {
        margin: 0 0 0.5rem;
        color: var(--primary-color);
        font-size: 1.75rem;
        font-weight: 600;
    }

    .profile-header-content p {
        margin: 0;
        color: #6b7a90;
        font-size: 0.95rem;
    }

    .profile-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
    }

    .info-item {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }

    .info-label {
        color: #6b7a90;
        font-size: 0.875rem;
        font-weight: 500;
    }

    .info-value {
        color: var(--dark-color);
        font-size: 1rem;
        font-weight: 500;
    }

    .status-badge {
        display: inline-block;
        padding: 0.4rem 0.9rem;
        border-radius: 999px;
        font-size: 0.8rem;
        background: var(--primary-color);
        color: white;
        font-weight: 600;
        text-transform: uppercase;
    }

    .booking-actions {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        margin-top: 1.5rem;
    }

    .btn-secondary {
        background: transparent;
        color: var(--primary-color);
        border: 2px solid var(--primary-color);
    }

    .btn-secondary:hover {
        background: var(--primary-color);
        color: white;
    }

    .empty-state {
        padding: 3rem 2rem;
        border: 2px dashed rgba(0, 0, 0, 0.15);
        border-radius: var(--border-radius);
        text-align: center;
        color: #6b7a90;
    }

    .empty-state h3 {
        margin: 0 0 1rem;
        color: var(--dark-color);
        font-size: 1.1rem;
    }

    .empty-state p {
        margin: 0 0 2rem;
        color: #6b7a90;
        font-size: 0.95rem;
    }

    .action-buttons {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin-top: 2rem;
    }

    .action-buttons .btn {
        width: 100%;
        padding: 0.875rem 1.5rem;
        font-size: 1rem;
        font-weight: 600;
    }

    .btn-logout {
        background: var(--error-color);
        color: white;
    }

    .btn-logout:hover {
        background: #c82333;
    }

    .summary-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .summary-header h2 {
        margin: 0 0 0.5rem;
        color: var(--primary-color);
        font-size: 1.5rem;
        font-weight: 600;
    }

    .summary-header p {
        margin: 0;
        color: #6b7a90;
        font-size: 0.9rem;
    }

    .history-btn {
        background: var(--primary-color);
        color: white;
        padding: 0.6rem 1.2rem;
        border-radius: var(--border-radius);
        text-decoration: none;
        font-size: 0.9rem;
        font-weight: 600;
        white-space: nowrap;
        transition: background-color 0.2s;
    }

    .history-btn:hover {
        background: #0056d6;
    }

    @media (max-width: 768px) {
        .profile-wrapper {
            padding: 0.5rem 0 2rem;
        }

        .profile-card, .summary-card {
            padding: 1.5rem;
        }

        .profile-header {
            flex-direction: column;
            align-items: flex-start;
        }

        .profile-grid {
            grid-template-columns: 1fr;
        }

        .summary-header {
            flex-direction: column;
        }

        .history-btn {
            width: 100%;
        }
    }
</style>

<section class="profile-wrapper">
    <article class="profile-card">
        <div class="profile-header">
            <div class="profile-avatar">
                {% with first_source=request.user.first_name|default:request.user.email %}
                    {% with last_source=request.user.last_name|default:request.user.email %}
                        {{ first_source|slice:":1"|lower }}{{ last_source|slice:":1"|lower }}
                    {% endwith %}
                {% endwith %}
            </div>
            <div class="profile-header-content">
                <h1>–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, {{ request.user.get_full_name|default:request.user.email }}!</h1>
                <p>–£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–≤–æ–∏–º–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏ –∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.</p>
            </div>
        </div>

        <div class="profile-grid">
            <div class="info-item">
                <span class="info-label">Email</span>
                <span class="info-value">{{ request.user.email }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">–¢–µ–ª–µ—Ñ–æ–Ω</span>
                <span class="info-value">{{ request.user.phone|default:"–Ω–µ —É–∫–∞–∑–∞–Ω" }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">–°—Ç–∞—Ç—É—Å –∞–∫–∫–∞—É–Ω—Ç–∞</span>
                <span class="status-badge">
                    {% if request.user.is_active %}
                        –ê–ö–¢–ò–í–ï–ù
                    {% else %}
                        –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù
                    {% endif %}
                </span>
            </div>
            <div class="info-item">
                <span class="info-label">–¢–∏–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</span>
                <span class="info-value">
                    {{ request.user.get_role_display }}
                </span>
            </div>
        </div>

        <div class="action-buttons" style="margin-top: 1.5rem;">
            <a href="{% url 'edit_profile' %}" class="btn btn-secondary">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</a>
            <a href="{% url 'reviews' %}" class="btn btn-secondary">‚≠ê –ú–æ–∏ –æ—Ç–∑—ã–≤—ã</a>
            {% if request.user.is_owner %}
                <a href="{% url 'my_rooms_bookings' %}" class="btn" style="background: #17a2b8;">üìã –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∏—Ö –∫–æ–º–Ω–∞—Ç</a>
            {% endif %}
            {% if request.user.is_admin %}
                <a href="/admin/" class="btn" style="background: #9c27b0;">üõ°Ô∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a>
            {% endif %}
            {% if request.user.is_staff %}
                <a href="{% url 'review_moderation_list' %}" class="btn" style="background: #ff9800;">üí¨ –ú–æ–¥–µ—Ä–∞—Ü–∏—è –æ—Ç–∑—ã–≤–æ–≤</a>
            {% endif %}
        </div>
    </article>

    <article class="summary-card">
        <div class="summary-header">
            <div>
                <h2>–¢–µ–∫—É—â–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
                <p>–°–ª–µ–¥–∏—Ç–µ –∑–∞ –¥–µ—Ç–∞–ª—è–º–∏ –≤–∞—à–∏—Ö –±–ª–∏–∂–∞–π—à–∏—Ö –ø–æ–µ–∑–¥–æ–∫.</p>
            </div>
            <a href="{% url 'booking_history' %}" class="history-btn">
                üìú –ò—Å—Ç–æ—Ä–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
            </a>
        </div>

        {% if booking %}
            <div style="padding: 1.5rem; background: var(--light-color); border-radius: var(--border-radius); margin-bottom: 1.5rem;">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
                    <strong style="color: var(--primary-color); font-size: 1.1rem;">{{ booking.room.get_room_type_display }} ‚Ä¢ {{ booking.room.price_per_night }} ‚ÇΩ / –Ω–æ—á—å</strong>
                    <span class="status-badge">{{ booking.get_status_display }}</span>
                </div>
                <div style="display:grid;gap:0.75rem;">
                    <div><strong>–¢–∏–ø –Ω–æ–º–µ—Ä–∞:</strong> {{ booking.room.get_room_type_display }}</div>
                    <div><strong>–ê–¥—Ä–µ—Å:</strong> {{ booking.room.address }}</div>
                    <div><strong>–î–∞—Ç—ã:</strong> {{ booking.check_in_date|date:"d.m.Y" }} ‚Äî {{ booking.check_out_date|date:"d.m.Y" }}</div>
                    <div><strong>–ò—Ç–æ–≥–æ:</strong> {{ booking.total_cost|floatformat:2 }} ‚ÇΩ</div>
                </div>
            </div>
            <div class="booking-actions">
                {% if booking.status == 'Pending' %}
                    <a href="{% url 'booking_confirm' booking.pk %}" class="btn" style="background: var(--success-color); color: white;">‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</a>
                {% endif %}
                <a href="{% url 'booking_update' booking.pk %}" class="btn btn-secondary">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω—å</a>
                <a href="{% url 'booking_delete' booking.pk %}" class="btn btn-logout">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
            </div>
        {% else %}
            <div class="empty-state">
                <h3>–ü–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</h3>
                <p>–ù–∞—á–Ω–∏—Ç–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–æ–µ–∑–¥–∫—É, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∑–¥–µ—Å—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –±—Ä–æ–Ω–∏ –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–µ–∑–¥–∫–æ–π.</p>
            </div>
            <div class="action-buttons">
                <a href="{% url 'home' %}" class="btn">–ù–∞–π—Ç–∏ –æ—Ç–µ–ª—å</a>
                <a href="{% url 'edit_profile' %}" class="btn">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</a>
            </div>
        {% endif %}
    </article>

    <!-- –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–Ω–∞—Ç –≤–ª–∞–¥–µ–ª—å—Ü–∞ -->
    {% if request.user.is_owner and owner_bookings %}
    <article class="summary-card">
        <div class="summary-header">
            <div>
                <h2>–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∏—Ö –∫–æ–º–Ω–∞—Ç</h2>
                <p>–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏ –≤–∞—à–∏—Ö –∫–æ–º–Ω–∞—Ç</p>
            </div>
        </div>

        <div style="display:grid;gap:1.5rem;">
            {% for owner_booking in owner_bookings %}
                <div class="info-row" style="flex-direction:column;align-items:flex-start;gap:0.75rem;">
                    <div style="display:flex;justify-content:space-between;width:100%;align-items:center;">
                        <strong>{{ owner_booking.room.get_room_type_display }} ‚Ä¢ {{ owner_booking.room.price_per_night }} ‚ÇΩ / –Ω–æ—á—å</strong>
                        <span class="status-chip">{{ owner_booking.get_status_display }}</span>
                    </div>
                    <div style="width:100%;display:grid;gap:0.5rem;">
                        <span><strong>–ì–æ—Å—Ç—å:</strong> {{ owner_booking.guest.get_full_name }}</span>
                        <span><strong>–ê–¥—Ä–µ—Å:</strong> {{ owner_booking.room.address }}</span>
                        <span><strong>–î–∞—Ç—ã:</strong> {{ owner_booking.check_in_date|date:"d.m.Y" }} ‚Äî {{ owner_booking.check_out_date|date:"d.m.Y" }}</span>
                        <span><strong>–ò—Ç–æ–≥–æ:</strong> {{ owner_booking.total_cost|floatformat:2 }} ‚ÇΩ</span>
                    </div>
                    {% if owner_booking.status == 'Pending' %}
                    <div class="booking-actions" style="margin-top:0.5rem;">
                        <a href="{% url 'booking_confirm' owner_booking.pk %}" class="btn" style="background: var(--success-color); color: white;">‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</a>
                    </div>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    </article>
    {% endif %}

    {% include 'main/user_rooms.html' %}
</section>
{% endblock %}

